--[[
	â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	CHECKPOINT BUTTON HANDLER
	â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	Usa el botÃ³n existente en StarterGui/Buttons/ScreenGui/CheckpointButton.
	Aparece cuando el jugador muere y tiene un checkpoint guardado.
	Ofrece teleportarse al checkpoint por 10 Robux.

	Auto-oculta despuÃ©s de 6 segundos.

	â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CONFIGURACIÃ“N
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local CHECKPOINT_PRODUCT_ID = 3502953308
local BUTTON_DURATION = 6 -- Segundos antes de auto-ocultar

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- BUSCAR BOTÃ“N EXISTENTE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Buscar el botÃ³n en StarterGui/Buttons/ScreenGui/CheckpointButton
local buttonsGui = playerGui:WaitForChild("Buttons", 10)
if not buttonsGui then
	warn("âŒ [CheckpointButton] No se encontrÃ³ ScreenGui 'Buttons'")
	return
end

local checkpointButton = buttonsGui:WaitForChild("CheckpointButton", 10)
if not checkpointButton then
	warn("âŒ [CheckpointButton] No se encontrÃ³ 'CheckpointButton' en Buttons ScreenGui")
	return
end

-- Ocultar el botÃ³n inicialmente
checkpointButton.Visible = false

print("âœ… [CheckpointButton] BotÃ³n encontrado y configurado")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- LÃ“GICA DEL BOTÃ“N
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local buttonVisible = false
local autoHideCoroutine = nil

-- Ocultar botÃ³n
local function hideButton()
	if not buttonVisible then return end

	buttonVisible = false
	checkpointButton.Visible = false

	-- Cancelar auto-hide si estÃ¡ corriendo
	if autoHideCoroutine then
		task.cancel(autoHideCoroutine)
		autoHideCoroutine = nil
	end

	print("ğŸ”’ [CheckpointButton] BotÃ³n ocultado")
end
-- Mostrar botÃ³n
local function showButton(checkpointData)
	if buttonVisible then
		-- Ya hay un botÃ³n visible, ocultarlo primero
		hideButton()
	end

	buttonVisible = true
	checkpointButton.Visible = true

	print("âœ… [CheckpointButton] BotÃ³n mostrado para checkpoint:", checkpointData.CheckpointName)

	-- Iniciar timer de auto-ocultar (6 segundos)
	if autoHideCoroutine then
		task.cancel(autoHideCoroutine)
	end

	autoHideCoroutine = task.spawn(function()
		task.wait(BUTTON_DURATION)
		if buttonVisible then
			hideButton()
		end
	end)
end



-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CLICK HANDLER DEL BOTÃ“N
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

checkpointButton.MouseButton1Click:Connect(function()
	print("ğŸ–±ï¸ [CheckpointButton] Click detectado")

	-- Abrir prompt de compra de Robux
	local success, err = pcall(function()
		MarketplaceService:PromptProductPurchase(player, CHECKPOINT_PRODUCT_ID)
	end)

	if not success then
		warn("âŒ Error al abrir prompt de compra:", err)
	end

	-- Ocultar botÃ³n (el teleport ocurrirÃ¡ despuÃ©s de la compra)
	hideButton()
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ESCUCHAR EVENTOS DEL SERVIDOR
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Esperar RemoteEvents
local remoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents")
local showDeathPopupEvent = remoteEvents:WaitForChild("ShowDeathPopup")
local teleportToCheckpointEvent = remoteEvents:WaitForChild("TeleportToCheckpoint")

-- Evento: Mostrar botÃ³n de checkpoint
showDeathPopupEvent.OnClientEvent:Connect(function(checkpointData)
	print("ğŸ”” [CheckpointButton] Mostrar botÃ³n. Checkpoint:", checkpointData.CheckpointName)
	showButton(checkpointData)
end)

-- Evento: Teleport activado (despuÃ©s de compra exitosa)
teleportToCheckpointEvent.OnClientEvent:Connect(function()
	print("âœ… [CheckpointButton] Compra exitosa, teleportando...")
	-- Comunicar al servidor para ejecutar el teleport
	teleportToCheckpointEvent:FireServer()
	-- Ocultar botÃ³n
	hideButton()
end)

print("[CheckpointButton] âœ… Sistema inicializado")
